
{
  "entities": {
    "Product": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Product",
      "type": "object",
      "description": "Represents a product in the inventory.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the product."
        },
        "name": {
          "type": "string",
          "description": "Name of the product."
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the product."
        },
        "sku": {
          "type": "string",
          "description": "Stock Keeping Unit - unique code for the product."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the product image.",
          "format": "uri"
        },
        "baseProductSku": {
            "type": "string",
            "description": "If this product is part of a pack, this is the SKU of the base unit. For the base unit itself, this matches its own SKU."
        },
        "containedUnits": {
            "type": "number",
            "description": "How many base units this product contains. For a single item, this is 1. For a 6-pack, this is 6."
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "sku",
        "baseProductSku",
        "containedUnits"
      ]
    },
    "Location": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Location",
      "type": "object",
      "description": "Represents a storage location for inventory.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the location."
        },
        "name": {
          "type": "string",
          "description": "Name of the location (e.g., Warehouse A, Store Shelf 1)."
        },
        "address": {
          "type": "string",
          "description": "Address of the location."
        }
      },
      "required": [
        "id",
        "name"
      ]
    },
    "Inventory": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Inventory",
      "type": "object",
      "description": "Represents the inventory level of a product at a specific location.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the inventory record."
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: Product 1:N Inventory)"
        },
        "locationId": {
          "type": "string",
          "description": "Reference to Location. (Relationship: Location 1:N Inventory)"
        },
        "quantity": {
          "type": "number",
          "description": "Quantity of the product at the location."
        }
      },
      "required": [
        "id",
        "productId",
        "locationId",
        "quantity"
      ]
    },
    "LowStockAlert": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "LowStockAlert",
      "type": "object",
      "description": "Represents a low stock alert for a product at a specific location.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the alert."
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: Product 1:N LowStockAlert)"
        },
        "locationId": {
          "type": "string",
          "description": "Reference to Location. (Relationship: Location 1:N LowStockAlert)"
        },
        "threshold": {
          "type": "number",
          "description": "Threshold at which the alert is triggered."
        },
        "alertedAt": {
          "type": "string",
          "description": "Timestamp when the alert was triggered.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "productId",
        "locationId",
        "threshold"
      ]
    },
    "StockCount": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "StockCount",
      "type": "object",
      "description": "Represents a stock count event.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the stock count event."
        },
        "locationId": {
          "type": "string",
          "description": "Reference to Location. (Relationship: Location 1:N StockCount)"
        },
        "countedAt": {
          "type": "string",
          "description": "Timestamp when the stock count was performed.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "locationId",
        "countedAt"
      ]
    },
    "StockCountItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "StockCountItem",
      "type": "object",
      "description": "Represents a single item counted during a stock count event.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the stock count item."
        },
        "stockCountId": {
          "type": "string",
          "description": "Reference to StockCount. (Relationship: StockCount 1:N StockCountItem)"
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: Product 1:N StockCountItem)"
        },
        "countedQuantity": {
          "type": "number",
          "description": "Quantity of the product counted during the stock count."
        },
        "expectedQuantity": {
          "type": "number",
          "description": "Expected quantity of the product based on inventory records."
        }
      },
      "required": [
        "id",
        "stockCountId",
        "productId",
        "countedQuantity",
        "expectedQuantity"
      ]
    },
    "Sale": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Sale",
      "type": "object",
      "description": "Represents a single sales transaction.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the sale."
        },
        "total": {
          "type": "number",
          "description": "The total amount of the sale."
        },
        "tax": {
          "type": "number",
          "description": "The tax amount for the sale."
        },
        "subtotal": {
          "type": "number",
          "description": "The subtotal amount for the sale."
        },
        "amountPaid": {
          "type": "number",
          "description": "The amount paid by the customer."
        },
        "changeDue": {
          "type": "number",
          "description": "The change given to the customer."
        },
        "salespersonId": {
          "type": "string",
          "description": "The ID of the user who made the sale."
        },
        "salespersonName": {
          "type": "string",
          "description": "The name of the user who made the sale."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the sale was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "total",
        "salespersonId",
        "salespersonName",
        "createdAt"
      ]
    },
    "SaleItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "SaleItem",
      "type": "object",
      "description": "Represents an item within a sale.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the sale item."
        },
        "saleId": {
          "type": "string",
          "description": "Reference to the Sale. (Relationship: Sale 1:N SaleItem)"
        },
        "productId": {
          "type": "string",
          "description": "Reference to the Product."
        },
        "productName": {
          "type": "string",
          "description": "Name of the product at the time of sale."
        },
        "quantity": {
          "type": "number",
          "description": "Quantity of the product sold."
        },
        "price": {
          "type": "number",
          "description": "Price of the product per unit at the time of sale."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the sale was created. Denormalized from the parent Sale for easier querying.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "saleId",
        "productId",
        "productName",
        "quantity",
        "price",
        "createdAt"
      ]
    },
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User Profile",
      "type": "object",
      "description": "Represents a user's public profile information.",
      "properties": {
        "name": {
          "type": "string",
          "description": "The user's first name."
        },
        "surname": {
          "type": "string",
          "description": "The user's last name."
        },
        "email": {
          "type": "string",
          "description": "The user's email address."
        },
        "role": {
          "type": "string",
          "description": "The user's role in the system.",
          "enum": [
            "administrator",
            "sales"
          ]
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the user account was created.",
          "format": "date-time"
        }
      },
      "required": [
        "name",
        "surname",
        "email",
        "role",
        "createdAt"
      ]
    }
  },
  "auth": {
    "providers": [
      "password"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/products/{productId}",
        "definition": {
          "entityName": "Product",
          "schema": {
            "$ref": "#/backend/entities/Product"
          },
          "description": "Stores product catalog information.",
          "params": [
            {
              "name": "productId",
              "description": "Unique identifier for the product."
            }
          ]
        }
      },
      {
        "path": "/locations/{locationId}",
        "definition": {
          "entityName": "Location",
          "schema": {
            "$ref": "#/backend/entities/Location"
          },
          "description": "Stores location information.",
          "params": [
            {
              "name": "locationId",
              "description": "Unique identifier for the location."
            }
          ]
        }
      },
      {
        "path": "/inventories/{inventoryId}",
        "definition": {
          "entityName": "Inventory",
          "schema": {
            "$ref": "#/backend/entities/Inventory"
          },
          "description": "Stores inventory levels for each product at each location.",
          "params": [
            {
              "name": "inventoryId",
              "description": "Unique identifier for the inventory record."
            }
          ]
        }
      },
      {
        "path": "/low_stock_alerts/{lowStockAlertId}",
        "definition": {
          "entityName": "LowStockAlert",
          "schema": {
            "$ref": "#/backend/entities/LowStockAlert"
          },
          "description": "Stores low stock alerts for products at specific locations.",
          "params": [
            {
              "name": "lowStockAlertId",
              "description": "Unique identifier for the alert."
            }
          ]
        }
      },
      {
        "path": "/stock_counts/{stockCountId}",
        "definition": {
          "entityName": "StockCount",
          "schema": {
            "$ref": "#/backend/entities/StockCount"
          },
          "description": "Stores stock count event information.",
          "params": [
            {
              "name": "stockCountId",
              "description": "Unique identifier for the stock count event."
            }
          ]
        }
      },
      {
        "path": "/stock_counts/{stockCountId}/stock_count_items/{stockCountItemId}",
        "definition": {
          "entityName": "StockCountItem",
          "schema": {
            "$ref": "#/backend/entities/StockCountItem"
          },
          "description": "Stores items counted during a stock count event.",
          "params": [
            {
              "name": "stockCountId",
              "description": "Unique identifier for the stock count event."
            },
            {
              "name": "stockCountItemId",
              "description": "Unique identifier for the stock count item."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{userId}",
        "definition": {
          "entityName": "roles_admin",
          "schema": {
            "$ref": "#/backend/entities/Product"
          },
          "description": "Documents in this collection grant `admin` role. Existence of the document grants authorization.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase user ID."
            }
          ]
        }
      },
      {
        "path": "/sales/{saleId}",
        "definition": {
          "entityName": "Sale",
          "schema": {
            "$ref": "#/backend/entities/Sale"
          },
          "description": "Stores records of each completed sale.",
          "params": [
            {
              "name": "saleId",
              "description": "Unique identifier for the sale."
            }
          ]
        }
      },
      {
        "path": "/sales/{saleId}/items/{itemId}",
        "definition": {
          "entityName": "SaleItem",
          "schema": {
            "$ref": "#/backend/entities/SaleItem"
          },
          "description": "Stores individual items within a sale.",
          "params": [
            {
              "name": "saleId",
              "description": "The ID of the parent sale document."
            },
            {
              "name": "itemId",
              "description": "Unique identifier for the sale item."
            }
          ]
        }
      },
       {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores public information about a user, mirrored from Firebase Auth.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase user ID."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the StockTrack application's core features: Product Catalog, Inventory Tracking, Stock Count Tool, Low Stock Alerts, and Reporting. The structure emphasizes clear data relationships, efficient querying, and robust security rules. The design ensures Authorization Independence by avoiding hierarchical authorization dependencies and denormalizing data where necessary. Segregation ensures different data have their own security constraints without interfering with each other. This architecture uses path-based ownership and dedicated collections to simplify access control. \n\nProducts, Locations, Inventories, LowStockAlerts, StockCounts, and StockCountItems are stored in separate collections for scalability and efficient querying. Relationships between these entities are maintained through document IDs. All documents within a collection share the same security posture, simplifying security rules.\n\n**Authorization Independence:** No `get()` calls are required in the security rules, which enables atomic operations and simplifies debugging.\n\n**QAPs Support:**\n\n*   `list` operations are secured because each collection contains homogenous data with uniform access requirements. The separation of collections based on entity type ensures that listing operations are always performed on data with consistent security constraints. The rules can then focus on verifying the existence of admin roles to grant access to critical operations like `list`.\n\n*   For data tied to specific locations, such as `Inventories`, `LowStockAlerts`, and `StockCounts`, the structure supports querying and listing operations scoped to a location without needing to fetch parent documents.\n\nThe database has not been configured to connect to a specific real or live database. It is just a configuration file."
  }
}
